---
title: 
translatedFrom: de
hash: gWZSfT/27ZhgCMYRlEThfOgb/imdjH72EMhmhUY7gNM=
---
Привет сообщество ioBroker,
<!-- SOURCE: 867436 Hallo ioBroker-Community, -->

Чтобы достичь марки **30.000** активных установок несколько дней назад, мы хотели бы представить вам новый js-controller 2.0. Это теперь доступно в Последнем Репозитории и на npm.
<!-- SOURCE: 402413 passend zum Erreichen der **30.000** aktive Installationen Marke vor ein paar Tagen möchten wir Euch nun gern den neuen js-controller 2.0 vorstellen. Dieser ist ab sofort im Latest Repository und auf npm verfügbar. -->

Во внутреннем тесте и очень обширном бета-тестировании в сообществе мы уже очень интенсивно протестировали это большое обновление js-контроллера. Большое спасибо @Arteck, @ sigi234, @SBorg, @opossum, @ e-s, @ e-i-k-e, @Yetiberg, @ Jan1, @ Einstein67, @Dr. Бактерий и многие другие. Это было отличное сотрудничество!
<!-- SOURCE: 540517 In einem internen Test und einen sehr umfangreichen Beta-Test in der Community haben wir dieses große Update des js-controllers bereits sehr intensiv getestet. Großer Dank geht an @Arteck, @sigi234, @SBorg, @opossum, @e-s, @e-i-k-e, @Yetiberg, @Jan1, @Einstein67, @Dr. Bakterius und viele andere mehr. Das war eine super Zusammenarbeit! -->

Прежде всего, «под капотом», были внесены некоторые фундаментальные изменения, оправдывающие переход на новый основной номер выпуска. Подробнее ниже.
<!-- SOURCE: 548903 Es sind vor allem "unter der Haube" einige grundlegende Änderungen eingeflossen, die den Wechsel auf eine neue Hauptrelease-Nummer rechtfertigen. Mehr dazu weiter unten. -->

JS-контроллер 2.0, как правило, совместим со всеми существующими системами ioBroker. Его можно обновить с любой предыдущей версии до версии 2.0. Только версия Node.js должна быть поднята до обновления как минимум 8.x, еще лучше 10.x! Для Node.js 12 это пока слишком рано, так как некоторые адаптеры все еще не совместимы.
<!-- SOURCE: 788980 Der js-controller 2.0 ist generell kompatibel mit allen bestehenden ioBroker-Systemen. Es kann von jeder früheren Version auf die Version 2.0 aktualisiert werden. Einzig die Node.js Version muss vor dem Update mindestens auf 8.x, besser noch auf 10.x angehoben werden! Für Node.js 12 ist es aber noch etwas zu früh, da hier immer noch einige Adapter nicht kompatibel sind. -->

Кроме того, собственное файловое пространство ioBroke (обычно в <каталоге ioBroker> / iobroker-data / files / ...) теперь обрабатывается более строго и вручную, либо с помощью сценария (fs.write), где могут непосредственно храниться файлы / hinkopierte. больше не отображается в визуализациях! Сценарии должны быть адаптированы (использование writeFile) или файлы должны храниться в официально определенных базовых каталогах adpater (например, vis.0, iqontrol.meta и т. Д.). Также лучше использовать официальные загрузчики через Vis или iqontrol, чтобы эти файлы были зарегистрированы правильно. Это изменение также было реализовано для повышения безопасности! Положительным побочным эффектом также является то, что файлы попадают в резервную копию, которая ранее не была доступна!
<!-- SOURCE: 624789 Weiterhin wird der ioBroke-Eigene-Dateibereich (im Normalfall bisher unter <ioBroker-Verzeichnis>/iobroker-data/files/...) nun strikter behandelt und manuell oder per Skript (fs.write) dort direkt abgelegte/hinkopierte Dateien sind ggf. nicht mehr in Visualisierungen anzeigbar!
Skripte müssen angepasst werden (Nutzung von writeFile) bzw. die Dateien müssen in offiziell definierte Adpater-Basisverzeichnisse (z.B. vis.0, iqontrol.meta u.ä.) abgelegt werden. Nutzt am besten auch die offiziellen Uploader via Vis oder iqontrol, damit diese Dateien korrekt registriert sind. Diese Änderung wurde auch zur Erhöhung der Sicherheit umgesetzt! Der positive Nebeneffekt ist auch das die Files dann mit im Backup landen, was bisher nicht gegeben war! -->

## Установка
<!-- SOURCE: 992937 ## Installation -->
Перед установкой Как и в случае любого такого обновления: сделайте резервную копию! Резервное копирование iobroker или копирование каталога iobroker-data также достаточны в случае сомнений (конечно, ioBroker остановится раньше). Пожалуйста, не копируйте каталог node_modules, в противном случае символические ссылки могут сломаться, что впоследствии приведет к большим проблемам.
<!-- SOURCE: 977716 Vor der Installation
Wie bei jedem Update dieser Art: Bitte macht ein Backup! iobroker backup, bzw. kopieren des iobroker-data Verzeichnisses reichen an sich im Zweifel auch aus (ioBroker vorher stoppen natürlich). Bitte nicht das node_modules Verzeichnis einfach kopieren, da sonst symbolische Links kaputt gehen können, was zu größeren Problemen danach führt. -->

### Необходимые обновления адаптера
<!-- SOURCE: 531397 ### Nötige Adapter-Aktualisierungen -->
Следующие адаптеры должны быть обновлены до упомянутых минимальных номеров версий, иначе они не будут работать с js-controller 2.0. Лучше всего сначала запустить эти обновления, потому что все эти версии хорошо работают со старыми версиями js-controller.
<!-- SOURCE: 951613 Die folgenden Adapter müssen auf die genannten Minimalversionsnummern aktualisiert werden, da diese sonst nicht mit dem js-controller 2.0 funktionieren. Diese Updates am besten vorher ausführen, weil alle genannten Versionen auch mit den alten js-controller Versionen funktionieren. -->

- простой API 2.1.2 или выше
<!-- SOURCE: 82139 - simple-api 2.1.2 or higher -->
- электронная почта 1.0.5 или выше
<!-- SOURCE: 366959 - email 1.0.5 or higher -->
- пушовер 1.1.1 или выше
<!-- SOURCE: 265223 - pushover 1.1.1 or higher -->
- оттенок 1.2.4 или выше
<!-- SOURCE: 605231 - hue 1.2.4 or higher -->
- красный узел 1.10.1 или выше
<!-- SOURCE: 881137 - node-red 1.10.1 or higher -->
- Vis 1.2.1 или выше
<!-- SOURCE: 870171 - vis 1.2.1 or higher -->
- iqontrol 0.2.6 или выше
<!-- SOURCE: 893159 - iqontrol 0.2.6 or higher -->
- socketio 2.1.2 или выше
<!-- SOURCE: 138473 - socketio 2.1.2 or higher -->
- radar2 1.0.9 (GitHub версии 1.2.0 необходимо настроить вручную, см. FAQ!)
<!-- SOURCE: 661372 - radar2 1.0.9 (GitHub version 1.2.0 muss manuell angepasst werden, siehe FAQ!) -->
- broadlink2 (см. FAQ)
<!-- SOURCE: 112362 - broadlink2 (siehe FAQ) -->

*** ВНИМАНИЕ: РАБНАЯ СИСТЕМА ПЕРВЫЙ! ***
<!-- SOURCE: 202904 ***ACHTUNG: SLAVE-SYSTEME ZUERST!*** -->

В случае системы с несколькими хостами при обновлении до версии 2.0 очень важно сначала обновить подчиненные системы. Мастер обновляется последним!
<!-- SOURCE: 121017 Bei einem Multi-Host-System ist es beim Update auf Version 2.0 sehr wichtig, die Slave-Systeme zuerst zu aktualisieren. Der Master wird als letztes aktualisiert! -->

Если этот порядок не соблюдается, подчиненные системы не могут подключиться к ведущему устройству, и обновление должно выполняться вручную (подробности см. В разделе FAQ).
<!-- SOURCE: 396110 Wenn diese Reihenfolge nicht eingehalten wird können sich die Slave-Systeme nicht mit dem master verbinden und das Update muss manuell ausgeführt werden (Details dazu siehe FAQ Post). -->

### Windows
<!-- SOURCE: 391795 ### Windows -->
В системах, настроенных с помощью нового установщика Windows, js-контроллер не должен обновляться до npm. Появится новая версия установщика Windows, которая позволяет обновлять js-контроллер несколькими щелчками мыши. Мы обновляем здесь в теме.
<!-- SOURCE: 86464 Auf Systemen, die mit dem neuen Windows Installer eingerichtet wurden, darf der js-controller nicht mir npm aktualisiert werden. Es wird eine neue Version des Windows Installers geben, die das Update des js-controllers mit wenigen Mausklicks ermöglicht. Wir updaten dazu hier im Thread. -->

Для всех «старых ручных» установок, как обычно, применяется та же команда ioBroker, что и для собственного обновления iobroker.
<!-- SOURCE: 45069 Für alle "alten manuellen" Installationen gilt der gleiche ioBroker-eigene iobroker upgrade self Befehl wie sonst auch. -->

### Linux
<!-- SOURCE: 517642 ### Linux -->
Как обычно, обновление будет выполнено через само обновление iobroker.
<!-- SOURCE: 543377 Wie üblich wird das Update per iobroker upgrade self ausgeführt. -->

В случае ошибок: если установка Linux не удалась из-за отсутствия прав доступа, лучше всего использовать установщик и повторить установку.
<!-- SOURCE: 368224 Bei Fehlern:
Wenn bei der Linux-Installation Fehler wegen fehlender Zugriffsrechte auftreten, am besten den Installation-Fixer nutzen und die Installation wiederholen. -->

```
curl -sL https://iobroker.net/fix.sh | bash -
```
<!-- ID: 515641 -->

Если после этого по-прежнему возникают ошибки, повторите попытку установки с помощью `sudo -H -u iobroker npm install iobroker.js-controller`. Пожалуйста, сообщайте о таких случаях здесь в теме.
<!-- SOURCE: 863021 Falls es auch danach noch Fehler gibt, bitte die Installation erneut mittels §§SSSSS_0§§ versuchen. Bitte berichtet solche Fälle hier im Thread. -->

## После установки
<!-- SOURCE: 155106 ## Nach der Installation -->
После установки перезапустите ioBroker (например, через запуск iobroker).
<!-- SOURCE: 666293 Nach der Installation den ioBroker wieder starten (z.B. mittels iobroker start). -->

Если все пойдет хорошо, вы не заметите никакой разницы, кроме более высокого номера версии в представлении администратора в админке. Все будет продолжать работать как прежде. Все экземпляры адаптера запускаются и работают. Если это так, все сработало. Большие изменения скрыты под капотом.
<!-- SOURCE: 806784 Wenn alles klappt merkt Ihr ausser der höheren Versionsnummer in der Host-Ansicht im Admin keinen Unterschied. Alles funktioniert weiterhin wie vorher. Alle Adapterinstanzen starten und funktionieren. Wenn das so ist hat alles geklappt. Die großen Änderungen sind alle "Unter der Haube" versteckt. -->

Кроме того, что приносит вам все нововведения, вы найдете ниже в этой текстовой информации. Новые функции в качестве основы для дальнейших разработок были тщательно интегрированы, и были решены конкретные проблемы.
<!-- SOURCE: 145066 Dazu, was Euch jetzt die ganzen Neuerungen bringen, findet Ihr weiter unten in diesem Text Informationen. Neue Funktionen als Basis für Weiterentwicklungen wurden behutsam integriert und einige bestehende Probleme gezielt behoben. -->

С помощью iobroker отображается список возможных команд командной строки, который стал длиннее с версией 2.0.
<!-- SOURCE: 821119 Mit iobroker help wird eine Liste der möglichen Kommandozeilen-Kommandos angezeigt, die mit Version 2.0 um einige Befehle länger geworden ist. -->

## Что изменилось, что посмотреть / проверить?
<!-- SOURCE: 235144 ## Was hat sich geändert, was besonders ansehen/testen? -->
Одним из основных изменений является то, что собственные базы данных состояний и объектов ioBroker были полностью переписаны. В системе ioBroker для связи теперь используется TCP-совместимый и Redis-совместимый протокол. Особенно ошибки «Переподключение из БД» теперь должны быть в прошлом. Основываясь на этих изменениях, мы планируем некоторые интересные инновации на будущее.
<!-- SOURCE: 58063 Eine der größeren Änderungen ist, dass die ioBroker-eigenen States- und Objects-Datenbanken vollständig neu geschrieben wurden. Im ioBroker-System wird zur Kommunikation jetzt ein TCP-basiertes und mit Redis-kompatibles Protokoll verwendet. Vor allem "Reconnection from DB"-Fehler sollten dadurch jetzt der Vergangenheit angehören. Auf Basis dieser Änderungen planen wir für die Zukunft noch einige interessante Neuerungen. -->

Из-за этого изменения теперь в журналах частично "подключен к redis", хотя вы не используете Redis. Однако вы все равно можете обнаружить его в порту, если это база данных ioBroker (обычно это порты 9000 и 9001). Первые тесты показали, что загрузка процессора процессором и js-контроллером ниже, чем в старой версии, поскольку новый протокол намного тоньше. Это все еще более гибко и надежно - до тех пор, пока сетевое соединение не разрывается. Но даже в таком случае должно произойти автоматическое переподключение, и, если прерывание не слишком продолжительное, любые изменения со времени без подключений будут переданы повторно.
Так что, если в прошлом вы страдали от сообщений и эффектов «Reconnect to DB», ваш отчет очень интересен для нас.
<!-- SOURCE: 337955 Durch diese Änderung steht jetzt in Logs teilweise "connected to redis" obwohl Ihr gar keinen Redis nutzt. Ihr könnt allerdings weiterhin am Port erkennen wenn es die ioBroker-eigene Datenbank ist (normalerweise Ports 9000 und 9001). Erste Tests haben gezeigt das die CPU Belastung der Adapter-Prozesse und des js-controller geringer ist als in der alten Version, da das neue Protokoll deutlich schlanker ist. Es ist weiterhin flexibler und robuster - so lange die Netzwerkverbindung nicht abreißt. Aber selbst in solch einem Fall sollte ein automatischer Reconnect stattfinden und, wenn der Abbruch nich zu lang ist, alle Änderungen aus der Zeit ohne Verbindungen nochmals gesendet werden.
Also falls Ihr in der Vergangenheit von "Reconnect to DB" Meldungen und Effekten geplagt wart ist Euer Bericht für uns sehr interessannt. -->

Аналогичным образом была улучшена пресловутая «Ошибка 7», которая появляется в журнале, если процесс адаптера уже запущен, но должен быть запущен новый. Если должен быть запущен новый процесс, процессы, которые все еще работают, должны автоматически завершать себя и генерировать одноразовое сообщение в журнале.
<!-- SOURCE: 818546 Ebenso der berühmt berüchtigte "Error 7", welcher im Log erscheint wenn ein Adapterprozess bereits läuft, aber ein neuer gestartet werden soll wurde verbessert. Wenn ein neuer Prozess gestartet werden soll, sollten sich nun ggf noch laufende Prozesse automatisch selbst beenden und eine einmalige Meldung im Log erzeugen. -->

Как я уже сказал, за кулисами произошло много изменений. Вот для интересующего в качестве спойлера резюме:
<!-- SOURCE: 895608 Wie bereits gesagt, viele Änderungen fanden hinter den Kulissen statt. Hier für Interessierte als Spoiler eine Zusammenfassung: -->

## 2.0 - релиз Белла
<!-- SOURCE: 268869 ## 2.0 - Release Bella -->
### Срочные изменения
<!-- SOURCE: 349413 ### Breaking changes -->
Минимальное требование для js-controller 2.0 - это node.js 8.x Файлы в iobroker-data / files поддерживаются только в официально зарегистрированных каталогах. Новые пользовательские функции
<!-- SOURCE: 897000 Minimum requirement for js-controller 2.0 is node.js 8.x
Files in iobroker-data/files are only supported in officially registered directories
New user features -->

- Добавить компактный режим и компактные группы (Technology Preview)
<!-- SOURCE: 763210 - Add Compact Mode and compact groups (Technology Preview) -->
- Добавить встроенную обработку псевдонимов для объектов / состояний (Technology Preview)
<!-- SOURCE: 391244 - Add build-in Alias handling for Objects/States (Technology Preview) -->
- Добавить поддержку Redis для объектов и файлов
<!-- SOURCE: 170065 - Add support to also use Redis for Objects and Files -->
- Добавить поддержку Redis Sentinel
<!-- SOURCE: 834226 - Add Redis sentinel support -->
- Разрешить динамическое изменение уровня логики для процессов экземпляра адаптера и хостов js-controller
<!-- SOURCE: 813079 - Allow dynamic change of Loglevel for adapter instance and js-controller hosts processes -->
- Добавьте дополнительную миграцию для значений State и / или Objects при использовании пользовательских настроек
<!-- SOURCE: 549492 - Add optional migration for State and/or Objects values when using setup custom -->
- Добавить мониторинг задержки цикла событий в качестве объектов хоста и адаптера.
<!-- SOURCE: 881854 - Add monitoring for event-Loop-Lag as host and adapter objects -->
- Добавить возможность проверки файлов резервных копий
<!-- SOURCE: 911506 - Add possibility to validate backup files -->
- Поддержка команды "iobroker logs"
<!-- SOURCE: 439067 - Support command „iobroker logs“ -->
- Поддержка команды "Сертификат создания"
<!-- SOURCE: 322051 - Support command „cert create“ -->
- Помните место установки для переустановок
<!-- SOURCE: 921545 - Remember installation location for reinstallations -->
- Используйте запомненное место установки для автоматической установки адаптера
<!-- SOURCE: 445217 - Use Remembered installation location for automatic adapter installs -->
- Идентификатор процесса регистрации для всех сообщений журнала адаптера
<!-- SOURCE: 519796 - Log Process-ID for all adapter log messages -->
- Улучшить некоторые команды CLI, такие как статус iobroker.
<!-- SOURCE: 946761 - Enhance some CLI commands like iobroker status -->
- Новые возможности разработчика адаптера
<!-- SOURCE: 2669 - New adapter developer features -->

Оптимизируйте редис по сравнению с обработкой файлов, которая была другой до контроллера 2.0:
<!-- SOURCE: 565150 Streamline redis vs file States handling which was different also before controller 2.0: -->

- не установленные состояния теперь всегда будут возвращать ноль
<!-- SOURCE: 970837 - not set states will always return null now -->
- Штаты хотят полностью обнулить (а не только значение), когда они истекают
<!-- SOURCE: 926824 - States will set to null completely (not only value) when they expire -->
- Штаты хотят публиковаться в обработчиках изменений, когда они находятся в Redis
<!-- SOURCE: 947957 - States will also be published to onChanged handlers when states are in Redis -->
- Добавьте метод adapter.supportsFeature ('NAME'), чтобы проверить, существует ли определенная функция. # 244
<!-- SOURCE: 145470 - Add adapter.supportsFeature('NAME') method to check if a certain feature exists. #244 -->
- Возможность определять защищенные объекты в io-pack доступе только через собственный адаптер и админа. # 287
<!-- SOURCE: 352225 - Ability to define secured objects in io-pack access only via own adapter and admin. #287 -->
- Добавлены getObjectView и getObjectViewAsync на объект адаптера
<!-- SOURCE: 153624 - Added getObjectView and getObjectViewAsync on adapter object -->
- Добавлены getObjectList и getObjectListAsync для объекта адаптера
<!-- SOURCE: 976964 - Added getObjectList and getObjectListAsync on adapter object -->
- Разрешить удаление нескольких объектов с подстановочными знаками
<!-- SOURCE: 518992 - Allow the deletion of multiple objects with wildcard -->
setObject / setObjectNotExists теперь устанавливает значение по умолчанию состояния после создания объекта
<!-- SOURCE: 634858 - setObject/setObjectNotExists now also sets default value of state after object creation -->
- Разрешить getPort проверять порт на определенном хосте / IP
<!-- SOURCE: 69504 - Allow getPort to check for the port optionally on a certain host/IP -->

### Дальнейшие изменения
<!-- SOURCE: 654155 ### Further changes -->
- Переписать базы данных InMem (States & Objects) по протоколу TCP (redis-совместимый) и отказаться от версии socket.io; хотят быть удалены ок. в v2.1
<!-- SOURCE: 504514 - Rewrite InMem databases (States & Objects) to TCP (redis compatible) protocol and deprecate socket.io version; will be removed approx. in v2.1 -->
- Добавьте обработку адаптера для предотвращения «ошибки 7» (адаптеры остановятся сами, как только PID не будет таким, как ожидалось)
<!-- SOURCE: 701129 - Add adapter handling to prevent "error 7" (adapters will stop themself as soon as PID is not as expected) -->
- обновить все зависимости
<!-- SOURCE: 456045 - Upgrade all dependencies -->
- не chmod 777 после обновления контроллера
<!-- SOURCE: 126545 - Don't chmod 777 after controller upgrade -->
- Рефакторинг многих команд консоли
<!-- SOURCE: 693108 - Refactoring of many CLI commands -->
- Добавить возможность вернуть zip-файл как ссылку, а не как base64
<!-- SOURCE: 698248 - Add possibility to return zip file as a link and not as base64 -->
- стандартизировать коды ошибок
<!-- SOURCE: 123628 - Standardize error codes -->
- Root всегда должен устанавливать npm с помощью --unsafe-perm
<!-- SOURCE: 71587 - Root should always npm install with --unsafe-perm -->
- Включить gzip для чтения репозиториев
<!-- SOURCE: 192852 - Enable gzip to read repositories -->
- Прочтите хэш исходников .json онлайн перед загрузкой всего файла
<!-- SOURCE: 784252 - Read hash of sources.json online before downloading the whole file -->
- Добавить некоторую информацию о user-agent
<!-- SOURCE: 883399 - Add some information about user-agent -->
- Проверьте версию node.js, запустив экземпляр
<!-- SOURCE: 962594 - Verify the version of node.js by start of the instance -->
- Скрыть окно cmd на окнах
<!-- SOURCE: 149728 - Hide cmd window on windows -->
- Сначала включите создание сертификата в настройку
<!-- SOURCE: 95409 - Include certificate creation in setup first -->
- Подавить предупреждение при установке npm
<!-- SOURCE: 618227 - Suppress warning by npm install -->
- Разрешить установку необязательных зависимостей
<!-- SOURCE: 385708 - Allow optional dependencies being installed -->
- Оптимизируйте настройку настраиваемой команды и добавьте дополнительные указания для пользователя.
<!-- SOURCE: 288477 - Optimize setup custom command and add more user guidance -->
- Добавить обзор функций в README
<!-- SOURCE: 26127 - Add Feature overview to README -->
- Пересылка выходных данных консоли с подчиненного устройства на ведущее
<!-- SOURCE: 61494 - Forward upload console outputs from slave to master -->
- Обязательно загрузите и обновите все адаптеры
<!-- SOURCE: 388539 - Make sure to upload and upgrade all relevant objects on installations and updates of adapters -->
- Всегда обновляйте объекты экземпляра после успешной установки или обновления
<!-- SOURCE: 828363 - Always upgrade instance objects after successful installs or upgrades -->
- Оптимизируйте процессы запуска адаптера, особенно в сочетании с необходимыми автоматическими установками адаптеров.
<!-- SOURCE: 459665 - Optimize adapter start processes, especially when combined with needed automatic installations of adapters -->
- После 2 попыток установки с помощью «last-connectedFrom» используйте поле установленной версии, чтобы попытаться выполнить установку с npm.
<!-- SOURCE: 125061 - After 2 installation tries with "last-installedFrom" use the installedVersion field to try to install from npm -->
- Hhosts теперь игнорирует изменения объекта, когда затронутые экземпляры молчат в installQueue
<!-- SOURCE: 175564 - Hhosts now ignore object changes when the affected instances is still in installQueue -->
- Рефакторинг и оптимизация кода в разных местах
<!-- SOURCE: 229542 - Code refactoring and optimizations in various places -->
- рандомизировать серийный номер сертификата
<!-- SOURCE: 704331 - Randomize Certificate Serial numbers -->
- отложить параллельный запуск запланированных экземпляров для предотвращения сценариев перегрузки системы (те же правила, что и для запуска адаптера, в основном задержка 4 с)
<!-- SOURCE: 499574 - delay parallel start of scheduled instances to prevent system overload scenarios (same rules asd for adapterstart, basically 4s delay) -->

### Исправления ошибок
<!-- SOURCE: 463735 ### Bugfixes -->
- Журнал запланированных перезапусков только как информация (исправления # 315)
<!-- SOURCE: 782015 - Log scheduled restarts as info only (fixes #315) -->
- Исправлено # 340 для поддержания restartSchedule на обновлениях
<!-- SOURCE: 191839 - Fixed #340 to maintain restartSchedule on updates -->
Исправлена ошибка, при которой можно было установить «ack» на любое значение через cli
<!-- SOURCE: 452157 - Fixed a bug where it was possible to set "ack" to any value via cli -->
- Включите ESLint и исправьте большинство проблем
<!-- SOURCE: 874077 - Enable ESLint and fix most issues -->
- Оптимизировать загрузку нескольких хостов
<!-- SOURCE: 139769 - Optimize multi host upload -->
- Перезапустите остановленные адаптеры в конце загрузки, но не до обновления
<!-- SOURCE: 214281 - Restart stopped adapters at the end of the upload and not before to make sure to not have two adapter restarts on upgrade cases -->
- Усовершенствовать проверки для неудачных установок в Cli и контроллер
<!-- SOURCE: 149794 - Enhance checks for failed installations in cli and controller -->
- обновлять статистические объекты экземпляра адаптера, когда instanceObejcts не определены
<!-- SOURCE: 35920 - Also update adapter instance statistic objects when no instanceObejcts are defined -->
- Значения состояния «.alive» проверяются при запуске адаптера, если ack = true, чтобы разрешить запуск процесса, если он не запущен
<!-- SOURCE: 926387 - ".alive" state values are only checked on adapter start if ack=true to allow to start a process if not running -->
- Исправлено обнаружение мутлихоста.
<!-- SOURCE: 569466 - Fix for mutlihost detection -->
- Исправлено резервное копирование состояний
<!-- SOURCE: 571230 - Fix backup of states -->
- Убедитесь, что глобальный CSS VIS включен в резервную копию и восстановлен
<!-- SOURCE: 576020 - Make sure also VIS global CSS is included in backup and restored -->
- еще много исправлений в разных местах
<!-- SOURCE: 726523 - Many more fixes in various places -->

Более подробную информацию об изменениях и исправлениях ошибок можно найти в журнале изменений.
<!-- SOURCE: 110506 Weitere Details zu den Änderungen und Bugfixes ist im Changelog einzusehen. -->

## Как сообщить об ошибке?
<!-- SOURCE: 653658 ## Wie Fehler melden? -->
Если вы не уверены, есть ли ошибка, лучше всего описать проблему здесь, в теме. Таким образом, мы все можем попытаться понять проблему и сузить при необходимости.
<!-- SOURCE: 602450 Wer sich unsicher ist, ob ein Fehler vorliegt, sollte am besten hier im Thread das Problem beschreiben. So können wir alle versuchen, das Problem nachzuvollziehen und ggf. einzugrenzen. -->

Как только возникает ошибка, которая заканчивается сообщением об ошибке или сбоем с подробными сведениями об ошибке в журнале или в командной строке, лучше всего непосредственно открыть проблему GitHub в проекте js-controller и дополнительно опубликовать ее в потоке здесь. Более подробная информация в выпуске (точные сообщения об ошибках / журналы, информация об используемой конфигурации БД (файл (file, file / redis, redis / redis ...), информация об ОС и среде Node.js, а также точные шаги к Воспроизведение проблемы), тем быстрее мы можем кружить и исправлять ошибки.
<!-- SOURCE: 476331 Sobald ein Fehler auftritt der in einer Fehlermeldung oder einen Crash mit Fehlerdetails im Log oder auf Kommandozeile endet, dann dazu am besten direkt ein GitHub-Issue im js-controller Projekt öffnen und zusätzlich hier im Thread posten. Je detaillierter die Angaben im Issue sind (genaue Fehlermeldungen/Logs, Info zur verwendeten DB-Konstellation (file(file, file/redis, redis/redis ...), Infos zur OS- und Node.js-Umgebung sowie genaue Schritte zur Reproduktion des Problems), umso schneller können wir Fehler einkreisen und beheben. -->

## Обзор некоторых новых функций
<!-- SOURCE: 233576 ## Überblick über einige der neuen Features -->
### 1.Компактный режим и компактные группы
<!-- SOURCE: 62195 ### 1.Compact Modus und Compact Gruppen -->
Одним из больших преимуществ ioBroker является то, что каждый адаптер работает как отдельный процесс. Это делает систему очень стабильной - в случае проблем они затрагивают только один адаптер, а не всю систему. С другой стороны, этот подход также требует немного больше оперативной памяти. Для систем с небольшим объемом доступной ОЗУ (таких как Raspi Nano или Raspi 1 с 512 МБ ОЗУ), которые часто используются в качестве подчиненных систем, количество адаптеров ограничено.
<!-- SOURCE: 149031 Eines der großen Vorteile von ioBroker ist, dass jeder Adapter als eigener Prozess ausgeführt wird. Das macht das System sehr stabil - bei Problemen betreffen diese nur den einen Adapter und nicht das ganze System. Andererseits benötigt dieser Ansatz allerdings auch etwas mehr RAM. Für Systeme mit wenig verfügbarem RAM (z.B. Raspi Nano oder Raspi 1 mit 512MB RAM), die oft als Slave-Systeme eingesetzt werden, ist die Anzahl der Adapter damit limitiert. -->

Компактный режим решает эту проблему, запуская несколько адаптеров вместе в одном процессе, значительно снижая требования к ОЗУ (экономя примерно 20-30 МБ на экземпляр адаптера). Однако это происходит за счет стабильности, поскольку неисправный адаптер также влияет на все остальные адаптеры в том же процессе, и это также может перезапускаться.
<!-- SOURCE: 108978 Der Compact Modus löst dieses Problem dadurch, dass mehrere Adapter zusammen in einem Prozess laufen und damit der RAM-Bedarf deutlich geringer ist (es werden etwa 20-30MB je Adapter-Instanz eingespart). Dies geht aber zu Lasten der Stabilität, da ein fehlerhafter Adapter auch alle anderen Adapter im gleichen Prozess betrifft und diese sich ggf. ebenfalls neu starten. -->

Экземпляры адаптера можно разделить на несколько групп, чтобы распределить риск. Каждая группа запускает свой собственный процесс, в котором затем выполняются все экземпляры этой группы. Группа 0 особенная. Членство здесь означает, что рассматриваемый адаптер работает в основном процессе js-контроллера. Это приводит к наибольшей экономии ОЗУ, но также и к наибольшему риску, поскольку неисправный адаптер может отрицательно повлиять на контроллер js. По умолчанию экземпляры в группе 1 выполняются, когда для соответствующего экземпляра включен компактный режим.
<!-- SOURCE: 964972 Adapter-Instanzen können dazu, um das Risiko etwas zu verteilen, in mehrere Gruppen aufgeteilt werden. Jede Gruppe startet einen eigenen Prozess, in dem dann alle Instanzen dieser Gruppe ausgeführt werden. Die Gruppe 0 ist speziell. Hier Mitglied zu sein bedeutet, dass der betreffende Adapter im Haupt-js-controller-Prozess ausgeführt wird. Dies ergibt die größte RAM-Ersparnis - allerdings auch das größte Risiko, da ein fehlerhafter Adapter den js-controller negativ beeinflussen kann. Als Standard werden Instanzen in der Gruppe 1 ausgeführt, wenn der Compact Modus für die entsprechende Instanz aktiviert wird. -->

Поддержка адаптера компактным режимом зависит от адаптера. Эта информация все еще будет включена в список адаптеров в будущем. В настоящее время в компактном режиме запускаются только адаптеры, работающие в качестве демона (т.е. без запланированных адаптеров). Даже если адаптер обычно поддерживает компактный режим, использование должно быть активировано индивидуально для каждого экземпляра!
<!-- SOURCE: 189002 Ob ein Adapter den Compact Modus unterstützt, hängt vom jeweiligen Adapter ab. Diese Information wird künftig noch in der Adapterliste aufgenommen. Aktuell werden nur Adapter die als daemon ausgeführt werden auch im Compact Modus gestartet (also keine scheduled-Adapter). Auch wenn der Adapter generell den Compact-Mode unterstützt muss die Nutzung pro Instanz einzeln aktiviert werden! -->

В настоящее время нет поддержки для настройки компактного режима в Admin. Конфигурация выполняется с помощью вызова из командной строки. Наиболее важные команды:
<!-- SOURCE: 871503 Zur Zeit gibt es zur Konfiguration des Compact Modus noch keine Unterstützung im Admin. Die Konfiguration erfolgt per Kommandozeilen-Aufruf. Die wichtigsten Kommandos sind: -->

iobroker compact позволяет вообще активировать режим Compact для текущего хоста js-контроллера. ioBroker должен быть перезапущен, чтобы изменения вступили в силу.
Экземпляры списка iobroker теперь также отображают состояние компактного режима экземпляров адаптера.
iobroker compact <имя адаптера>. <экземпляр> показывает состояние компактного режима экземпляра.
iobroker compact <имя адаптера>. <экземпляр> enable 1 активирует выполнение в групповом режиме «1» в компактном режиме. Только адаптер будет перезапущен. Эта конфигурация может быть выполнена во время работы ioBroker.
Если есть проблемы (например, адаптер не работает чистым или «зависает» во время остановки), пожалуйста, откройте проблему с адаптером. В противном случае, пожалуйста, напишите здесь в теме, чтобы мы увидели, что это такое.
<!-- SOURCE: 494 iobroker compact enable zum generellen Aktivieren des Compact Modus für den aktuellen js-controller Host. ioBroker muss danach neu gestartet werden, damit die Änderung aktiv wird.
iobroker list instances zeigt zusätzliche jetzt auch den Status des Compact Modus der Adapterinstanzen an.
iobroker compact <adaptername>.<instanz> status zeigt den Compact Modus Status der Instanz an.
iobroker compact <adaptername>.<instanz> enable 1 aktiviert die Ausführung im Compact Modus in Gruppe „1“. Nur der Adapter wird dabei neu gestartet. Diese Konfiguration kann bei laufendem ioBroker erfolgen.
Falls es Probleme gibt (z.B. ein Adapter läuft nicht mehr sauber oder bleibt "hängen" beim Stoppen), dann bitte ein Issue beim Adapter öffnen. Ansonsten bitte hier im Thread posten, damit wir sehen, woran es liegt. -->

### 2. Источник установки адаптеров сохранен
<!-- SOURCE: 730867 ### 2. Installations-Quelle von Adaptern wird gespeichert -->
Адаптеры ioBroker обычно устанавливаются из последнего или стабильного репозитория npm. Если адаптер необходимо перенести на другой хост или систему необходимо переустановить, будет предпринята попытка снова установить ту же версию npm. Обычно это тоже работает. Однако, если адаптер был установлен GitHub на пробной основе, эта версия или версия может быть недоступна на npm. Таким образом, одна и та же версия не может быть переустановлена автоматически. Это меняется сейчас.
<!-- SOURCE: 547135 ioBroker-Adapter werden im Normalfall aus dem Latest- oder Stable-Repository von npm installiert. Falls ein Adapter auf einen anderen Host verschoben wird oder das System neu installiert werden muss, wird versucht die gleiche Version wieder von npm zu installieren. Im Normalfall klappt das auch. Falls ein Adapter allerdings testweise von GitHub installiert wurde, ist dieser Stand bzw. diese Version ggf. nicht auf npm verfügbar. Damit kann die gleiche Version nicht automatisch neu installiert werden. Dies ändert sich nun. -->

Для всех новых установок адаптера после обновления ioBroker запоминает точное состояние GitHub пользовательской установки и затем может установить эту версию снова.
<!-- SOURCE: 60184 Für alle neuen Adapterinstallationen nach dem Update merkt sich ioBroker den genauen GitHub-Stand einer Custom-Installation und kann diesen Stand dann wieder nachinstallieren. -->

Также при самой установке адаптера, загрузка и многое другое было пересмотрено и оптимизировано. Исправлены некоторые особые случаи, когда части логики загрузки выполнялись некорректно. Опять же, помогите с вашими тестами.
<!-- SOURCE: 722049 Auch an der Adapterinstallation selbst, dem Upload und ähnlichem wurde einiges überarbeitet und optimiert. Es wurden einige Sonderfälle behoben, wo teile der upload-Logik nicht korrekt ausgeführt wurden. Auch hier helfen eure Tests. -->

### 3. Поддержка Redis теперь также для объектов и файлов
<!-- SOURCE: 665940 ### 3. Redis-Unterstützung nun auch für Objekte und Files -->
По умолчанию объекты и состояния хранятся в базе данных хранилища ioBroker и хранятся в файлах JSON. Благодаря этому собственному решению дополнительное программное обеспечение не требуется.
<!-- SOURCE: 541420 Standardmäßig werden Objekte und Zustände in einer ioBroker-eigenen Speicher-Datenbank verwaltet und in JSON-Dateien gespeichert. Mit dieser eigenen Lösung wird keine weitere Software benötigt. -->

В течение некоторого времени уже было возможно сохранять состояния в оптимизированной базе данных Redis. Начиная с определенного количества изменений состояния в секунду, Redis может снизить общую нагрузку системы или распределить ее по нескольким системам. Redis, однако, также приносит с собой дополнительные усилия, так как это программное обеспечение хочет быть установленным, управляемым и защищенным, чтобы не было потери данных в случае обновлений или проблем.
<!-- SOURCE: 919780 Seit einiger Zeit ist es bereits möglich, Zustände alternativ in einer optimierten Redis-Datenbank zu speichern. Ab einiger gewissen Anzahl an Zustandsänderungen pro Sekunde kann durch den Einsatz von Redis die Gesamtsystemlast zurückgehen bzw. auf mehrere Systeme verteilt werden. Redis bringt allerdings auch einen Mehraufwand mit, da diese Software installiert, verwaltet und gesichert werden will, damit es bei Updates oder im Problemfall nicht zu einem Datenverlust kommt. -->

С помощью js-controller 2.0 ioBroker теперь также позволяет управлять объектами и файлами, которые в данный момент хранятся в основной системе в файловой системе, в базе данных Redis.
<!-- SOURCE: 467440 Mit js-controller 2.0 erlaubt ioBroker nun auch Objekte und die Dateien, die aktuell auf dem Master-System im Dateisystem abgelegt sind, in der Redis-Datenbank zu verwalten. -->

Важно: особенно передача файлов в базу данных может привести к тому, что она станет довольно большой (например, несколько сотен МБ). Поскольку Redis всегда хранит все данные в оперативной памяти, этот параметр подходит только для систем, в которых имеется достаточно ресурсов оперативной памяти. Аналогично, загрузка процессора будет выше для системы redis / redis, поскольку данные должны обрабатываться по-разному.
<!-- SOURCE: 424549 Wichtig: Vor allem die Verlagerung von Dateien in die Datenbank kann dazu führen, dass diese recht groß werden kann (gern mehrere hundert MB). Da Redis alle Daten immer im RAM hält, ist diese Option nur für Systeme geeignet, die genügend RAM-Ressourcen zur Verfügung haben. Ebenso die CPU Belastung wird bei einem redis/redis System höher sein weil Daten anders verarbeitet werden müssen. -->

Перемещение файлов в базу данных обеспечивает большую гибкость. Из-за этого изменения в файловой системе практически нет локальных данных. В общем, база данных Redis становится центральной системой хранения данных системы ioBroker, поскольку она содержит все данные. Все контроллеры и адаптеры js затем подключаются к этой центральной базе данных.
<!-- SOURCE: 209670 Die Verlagerung von Dateien in die Datenbank führt zu einer deutlich größeren Flexibilität. Aufgrund dieser Änderung gibt es quasi keine lokalen Daten im Dateisystem mehr. In Summe wird die Redis-Datenbank zur zentralen Datenhaltung des ioBroker-Systems, da sie sämtliche Daten beinhaltet. Alle js-controller und Adapter verbinden sich dann mit dieser zentralen Datenbank. -->

С js-controller 2.x даже установка Redis-Sentinel может использоваться для повышения доступности системы (почти как кластер Redis HA). Это первая основа для обеспечения системы ioBroker высокой доступности, которая может компенсировать сбои отдельных компонентов сервера. Тем не менее, этот параметр в настоящее время должен быть протестирован, только если вы знаете, что делаете you В более поздних обновлениях больше.
<!-- SOURCE: 795839 Mit dem js-controller 2.x kann sogar eine Redis-Sentinel Installation zur Steigerung der Systemverfügbarkeit genutzt werden (quasi ein Redis-HA-Cluster). Das ist eine erste Grundlage für die Bereitstellung eines hochverfügbaren ioBroker-Systems, das Ausfälle einzelner Serverkomponenten kompensieren kann. Diese Option sollte man allerdings aktuell nur austesten wenn man weiss was man tut 😉 Dazu in späteren Updates mehr. -->

С введением различных возможностей хранения файлов, объектов и состояний команда настройки iobroker была пересмотрена. С одной стороны, это показывает больше информации. Кроме того, он теперь также может переносить данные во всех направлениях при изменении управления данными. Таким образом, изменение возможно в любое время.
<!-- SOURCE: 663040 Mit dem Einzug der verschiedenen Speichermöglichkeiten für Dateien, Objects und States wurde der Befehl iobroker setup custom überarbeitet. Zum einen zeigt er mehr Informationen an. Zusätzlich ist er jetzt aber auch in der Lage, bei einem Wechsel der Datenhaltung die Daten in alle Richtungen zu migrieren. So ist ein Wechsel jederzeit möglich. -->

### 4. Функция "Псевдоним"
<!-- SOURCE: 148283 ### 4. "Alias"-Feature -->
Одним из преимуществ ioBroker является то, что есть много адаптеров. Однако было обнаружено, что каждый адаптер, например, В зависимости от подключенных систем реализуются отдельные структуры для хранения предоставленных точек данных. Это связано с определенными сценариями, а также с визуализацией и облачными / iot-адаптерами.
При замене устройств между различными производителями иногда необходимо настроить сценарии из-за изменений в точках данных. Адаптер визуализации и адаптер iot попробуйте, например, Определите тип устройств на основе ролей точек данных для правильного отображения или отправки отчетов в Amazon или Google. Адаптеры иногда теряются, потому что некоторые адаптеры имеют информацию о ролях и тому подобное. не может доставить - особенно MQTT, Modbus и т. д. затронуты здесь.
<!-- SOURCE: 555636 Einer der Vorteile von ioBroker ist, dass es sehr viele Adapter gibt. Allerdings hat sich herausgestellt, das jeder Adapter z.B. je nach angebundenen Systemen durchaus individuelle Strukturen bezüglich der Ablage der bereitgestellten Datenpunkte implementiert. Dies bringt vor allem bei eigenen Skripten aber auch bei Visualisierungs- und den Cloud/iot-Adaptern gewisse Herausforderungen mit sich.
Beim Austausch von Geräten zwischen verschiedenen Herstellern muss man so gelegentlich aufgrund der Änderungen bei den Datenpunkten Skripte anpassen. Visualisierungsadapter und der iot-Adapter versuchen z.B. anhand der Rollen von Datenpunkten den Typ von Geräten zu erkennen, um diese korrekt anzuzeigen bzw. an Amazon bzw. Google zu melden. Dabei stehen die Adapter manchmal auf verlorenem Posten, weil bestimmte Adapter Informationen zu Rollen u.ä. gar nicht liefern können - vor allem MQTT, modbus u.ä. sind hier betroffen. -->

Функция псевдонима, привязанная непосредственно к контроллеру js, предоставляет новое пространство имен «alias.0» для объектов. Эта функция позволяет создавать устройства со стабильной структурой и чистыми ролями. Это делается сначала вручную, а затем, например, с использованием нового адаптера «Устройства», который находится в стадии разработки.
<!-- SOURCE: 88742 Das Alias Feature, das direkt im js-controller verankert ist, stellt den neuen Namespace "alias.0" für Objekte zur Verfügung. Das Feature erlaubt es, Geräte mit einer stabilen Struktur und sauberen Rollen anzulegen. Das erfolgt jetzt zuerst manuell, später auch z.B. mittels des kommenden "Devices"-Adapters, der sich gerade in Entwicklung befindet. -->

Также эта функция не имеет полной поддержки в админке, которая все же появится.
<!-- SOURCE: 484863 Auch dieses Feature hat noch keine vollständige Unterstützung im Admin, was allerdings noch kommen wird. -->

После определения объекта псевдонима новая область common.alias может использоваться для определения идентификатора исходного объекта в соответствующем адаптере. С этого момента все данные будут синхронизироваться в обоих направлениях между объектами. Кроме того, интересно, что функции чтения и записи могут быть определены для простых преобразований (например, Wh <-> кВтч).
<!-- SOURCE: 507707 Nach der Definition des Alias-Objects kann im neuen Bereich common.alias die ID des Quellobjekts im jeweiligen Adapter definiert werden. Ab dann werden alle Daten in beide Richtungen zwischen den Objekten synchronisiert. Zusätzlich kann interessanterweise eine read und write Funktion definiert werden, um einfache Umrechnungen vorzunehmen (z.B. Wh <--> kWh). -->

Дальнейшие (технические) подробности были опубликованы под Alias Information в js-controller README.
<!-- SOURCE: 970076 Weitere (technische) Details haben wir unter Alias Information in der js-controller README veröffentlicht. -->