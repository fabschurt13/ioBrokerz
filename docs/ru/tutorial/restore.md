---
title: Выполнить восстановление ioBroker
lastChanged: 03.12.2019
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/tutorial/restore.md
hash: XRWMH0ssI6i1cdQZvkzC7mxxLOtV1gF9ARP8fTcBX78=
---
# Основы
Как правильно восстановить установку ioBroker в системе Linux?

### Предисловие:
Поскольку некоторые пользователи находят восстановление очень трудным, должно помочь пошаговое руководство по восстановлению после сбоя или после замены оборудования, изменения системы или чего-либо еще.

В принципе, одно можно сказать заранее: восстановление может быть выполнено за несколько минут, если все сделано правильно, и никто не должен бояться этого.

В конце концов, все данные снова доступны, и была установлена новая система.

### Подготовка:
Исполняемый файл ioBroker необходим для подготовки.

Есть два способа сделать это.
Либо возьмите готовый образ из [область загрузки](https://www.iobroker.net/#de/download), настройте свою собственную ОС Linux и установите ioBroker в соответствии с этим [инструкции](https://www.iobroker.net/#de/documentation/install/linux.md).

### Следующий шаг
Если старая система сохранила состояния и / или объекты в Redis, новая система должна сначала быть оснащена сервером Redis.

Если нет уверенности в том, что Redis использовался и доступ к старой системе все еще существует, используйте команду `iobroker status` для получения необходимой информации. «При использовании Redis вывод выглядит следующим образом:

```
iobroker is running on this host.

At least one iobroker host is running.

Objects type: redis
States  type: redis
```

Если тип объектов и / или тип состояний говорит «redis», необходимо установить сервер Redis в новой системе.
Если оба типа говорят «файл», сервер Redis не требуется.

Если вам больше не нужно иметь доступ к старой системе и вы не знаете, что именно там было настроено, то заранее установите сервер Redis.

#### Redis установлен:
Для этого перейдите в терминал с помощью putty и выполните следующие команды:

```
sudo apt-get update
sudo apt-get install redis-server
sudo usermod -a -G redis iobroker
sudo reboot now
```

Следующий шаг - запустить исправление установщика, если все права в системе не должны соответствовать где-либо.
Этот шаг является только рекомендацией и не является абсолютно необходимым.

```
curl -sL https://iobroker.net/fix.sh | bash –
```

С помощью небольшого инструмента «htop» вы можете очень хорошо видеть все запущенные процессы, что может быть не только интересным для восстановления, но и в целом очень полезным.
это установлено следующим образом:

Запустите следующую команду в консоли:

```
sudo apt-get install htop
```

После того, как это было сделано, фактическое восстановление может произойти.

### Восстановить:
Здесь также есть два варианта:

#### **1. Автоматическое восстановление с резервным копированием**
Поскольку знания Linux здесь не требуются, и все это через веб-интерфейс Iobroker, вариант автоматического восстановления сначала выполняется с использованием [BackItUp](https://github.com/simatec/ioBroker.backitup/blob/master/README.md).

Для этого должен быть установлен адаптер Backitup.
Это делается через вкладку «Адаптер». Найдите там резервную копию и установите экземпляр, используя (+).

После завершения установки вы можете сохранить «ioBroker Backup», созданный старой системой, в новой системе, используя программу sftp, такую как FileZilla или WinSCP, в пути / opt / iobroker / backups.

Backitup также можно восстановить с NAS, Dropbox или Google Drive, но локальный вариант имеет наименьшую вероятность проблем.

Если у вас уже есть опыт монтирования NAS, его также можно использовать, тем более что вы можете напрямую получить доступ к существующему каталогу старой установки.
Однако этот учебник относится к локально сохраненной резервной копии.

Если резервная копия ioBroker была успешно сохранена, теперь открывается Backitup и открывается вкладка «Восстановление».
Установите «источник резервного копирования» на локальный, а затем сохраните.

![Восстановить вкладку](../../de/tutorial/media/restore/1575301096581-restoretab.jpg)

Если ВСЕ экземпляры должны запускаться автоматически после восстановления, необходимо активировать опцию «Запускать все адаптеры после восстановления», а затем сохранить ее.
Если резервная копия должна быть восстановлена на другом хосте, эту опцию не следует использовать, поскольку, возможно, придется настроить IP-адреса перед запуском отдельных экземпляров.

После сохранения существующие резервные копии можно вызвать по локальному пути с помощью кнопки «Получить резервные копии».

Резервная копия, только что скопированная через FTP, должна появиться в списке под «iobroker».
Теперь выберите это.

![Выбор резервных копий](../../de/tutorial/media/restore/1575301146928-restoreliste.jpg)

После выбора появляется сообщение, что iobroker остановлен для восстановления, а затем снова запущен.

![Начать восстановление](../../de/tutorial/media/restore/1575301175231-restorestart.jpg)

Здесь вы начали реальный процесс восстановления.

![Восстановление в процессе](../../de/tutorial/media/restore/1575301208033-restore.jpg)

Это может занять некоторое время в зависимости от производительности системы и размера старой установки ioBroker.
Обычно восстановление должно быть завершено примерно через 10-15 минут и ioBroker должен быть запущен снова.

![Восстановление сделано](../../de/tutorial/media/restore/1575301228008-restorefinish.jpg)

Если отображение не меняется, обновляйте окно браузера с помощью F5 время от времени.

В очень редких случаях ioBroker не запускается автоматически после восстановления.
Если это так, или вы не уверены, что восстановление все еще выполняется, вы можете использовать установленный инструмент htop, чтобы проверить, выполняется ли восстановление или уже завершилось.
Просто введите §§YYYYY_0§§ в терминале. Вывод должен выглядеть примерно так.

![HTOP](../../de/tutorial/media/restore/1575363981959-htop.jpg)

В процессах, которые могут отображаться с помощью htop **ни один из** процессов, отмеченных на рисунке, отсутствует.
В этом случае завершите htop клавишей «F10» и выполните следующую команду через терминал.

```
iobroker start
```

Теперь ioBroker должен запуститься снова, и на вкладке «Журнал» вы можете видеть, что все адаптеры, которые были установлены в старой системе, были заново установлены npm.

Теперь нужно приложить немного терпения, и iobroker можно легко сделать.
В случаях вы можете увидеть, какие адаптеры постепенно устанавливаются.
Все адаптеры, которые все еще устанавливаются или находятся в режиме ожидания, не имеют значков в экземплярах.
Пожалуйста, не перезапускайте ioBroker, самое большее обновляйте представление с помощью F5 время от времени, пока у всех экземпляров не появится значок.

В зависимости от размера установки, скорости вашего компьютера и подключения к Интернету, это может занять 2-3 часа.

Поздравляем, недавно установленная система укомплектована всеми настройками, сценариями, визуализациями и т. Д.

С Backitup теперь есть возможность восстановить дополнительные данные, если они были зарезервированы заранее на старой системе.
Вы можете восстановить базу данных Redis, базу данных Zigbee, базу данных mySql и ваши данные истории, выполнив те же действия, что описаны выше.

Список полученных резервных копий будет выглядеть в этом примере следующим образом.

![полный список](../../de/tutorial/media/restore/1575362131512-fullliste.jpg)

*****************************************************************************************************************************************

#### **2. ручное восстановление с помощью команд терминала**
Прежде всего, несколько команд должны быть введены через замазку или аналогичные.

Сначала необходимо создать резервную папку:

```
sudo mkdir /opt/iobroker/backups
```

Здесь также программа sftp, такая как FileZilla или WinSCP - резервная копия, созданная в старой системе, и, возможно, также резервная копия Redis, резервная копия zigbee и т. Д.
хранится в папке / opt / iobroker / backups.

Если состояния и объекты были сохранены в базе данных Redis, то сначала необходимо восстановить сохраненную базу данных Redis.
Если только штаты находились под управлением Redis, это не обязательно должно быть заранее.

Если это сделано, остановите ваш ioBroker следующим образом:

```
iobroker stop
```

Затем, пожалуйста, проверьте, все ли остановлено с помощью следующих команд:

```
iobroker status
```

Если все выходные данные верны и iobroker был остановлен, восстановление теперь можно выполнить через консоль с помощью следующих команд:

```
cd /opt/iobroker
iobroker restore <Dateiname eures Backups>
```

!> **Здесь очень важно, чтобы с помощью этого метода можно было восстановить только резервную копию ioBroker.
Резервная копия Redis, резервная копия Zigbee, резервная копия mySql или данные истории не могут быть созданы с помощью этой команды**

Для этого требуется Backitup, так как они были созданы специально с Backitup.

В зависимости от системы это может занять несколько минут. Прогресс отображается в терминале.
Когда восстановление будет завершено, перезапустите ioBroker с помощью следующей команды:

```
iobroker start
```

Здесь также все адаптеры переустанавливаются ioBroker индивидуально через npm.
Это может занять некоторое время в зависимости от размера вашей установки, скорости интернета и производительности системы.
Текущий статус можно отслеживать на вкладке «Журнал».

Теперь это сделано, и система установлена заново, и все настройки, сценарии, визуализации и т. Д. Восстановлены.

### Вывод:
По сути, оба варианта приводят к одному и тому же результату.
Если у вас мало опыта работы с терминальными командами и вы чувствуете себя небезопасным, Backitup находится на безопасной стороне.

Однако, если вы хотите точно увидеть, что происходит в вашей системе, вам следует выбрать ручной вариант через консоль. Здесь вы можете увидеть каждый процесс подробно в терминале.