---
title: ioBroker Restore
lastChanged: 03.12.2019
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/tutorial/restore.md
hash: PdKXVqljYzqz8sIsT9661nR4t5rhUnRIN98FYdrp0w8=
---
# Основы
Как правильно восстановить установку ioBroker в системе Linux?

### Предисловие:
Так как некоторые пользователи с восстановлением делают очень тяжело, здесь приведены пошаговые инструкции по восстановлению после сбоя или даже после смены оборудования, изменения системы или другой помощи.

В принципе, можно сказать одно заранее: восстановление выполняется с правильным выполнением за несколько минут, и никто не должен бояться.

В конце концов, все данные снова доступны, и была установлена новая система.

### Подготовка:
Исполняемый файл ioBroker абсолютно необходим для подготовки.

Чтобы сделать это, есть 2 способа.
Либо возьмите готовый образ из [область загрузки](https://www.iobroker.net/#de/download), установите свою собственную ОС Linux и установите ioBroker после этого [инструкции](https://www.iobroker.net/#de/documentation/install/linux.md).

### Следующий шаг
Если старая система хранила состояния и / или объекты в Redis, новая система должна сначала быть оснащена сервером Redis.

Если вы не уверены, что Redis использовался и все еще имеет доступ к старой системе, то получите необходимую информацию с помощью команды `iobroker status` «Вывод выглядит так при использовании Redis:

```
iobroker is running on this host.

At least one iobroker host is running.

Objects type: redis
States  type: redis
```

Если объекты типа и / или состояния типа «redis», вы должны установить сервер Redis в новой системе.
Если оба типа являются «файловыми», то сервер Redis не нужен.

Если у вас больше нет доступа к старой системе и вы не знаете, что было настроено ранее, то в любом случае заранее установите сервер Redis.

#### Redis установлен:
Чтобы пройти через Putty в терминале и выполнить следующие команды:

```
sudo apt-get update
sudo apt-get install redis-server
sudo usermod -a -G redis iobroker
sudo reboot now
```

Затем вы должны запустить время установки установщика, если где-то не все права должны соответствовать системе.
Этот шаг является только рекомендацией и не является обязательным.

```
curl -sL https://iobroker.net/fix.sh | bash –
```

С помощью небольшого инструмента «htop» вы можете очень хорошо видеть все запущенные процессы, что может быть очень полезно не только для интересного восстановления, но и в целом.
это будет установлено следующим образом:

В консоли выполните следующую команду:

```
sudo apt-get install htop
```

После того, как это сделано, оно может прийти к фактическому восстановлению.

### Восстановить:
Есть также 2 варианта:

#### **1. Автоматическое восстановление с помощью Backitup**
Поскольку знание Linux здесь не требуется, и все это через веб-интерфейс Iobroker является первым вариантом автоматического восстановления с использованием [BackItUp](https://github.com/simatec/ioBroker.backitup/blob/master/README.md).

Для этого должен быть установлен адаптер Backitup.
Это делается через вкладку «Адаптер». Там ищите Backitup и над (+) устанавливайте экземпляр.

Когда установка завершится, вы поместите ранее созданную из старой системы «ioBroker Backup» в новую систему с помощью программы sftp, такой как FileZilla или WinSCP, по пути / opt / iobroker / backups.

Backitup также может выполнять восстановление с NAS, Dropbox или Google Drive, но локальный вариант имеет наименьшую вероятность проблем.

Если у вас уже есть опыт монтирования с NAS, его также можно использовать с удовольствием, тем более что вы можете получить прямой доступ к существующему каталогу старой установки.
Тем не менее, это руководство относится к локально сохраненной резервной копии.

Если резервное копирование ioBroker было успешно сохранено, теперь откроется Backitup и откроется вкладка «Восстановление».
Там установите «Источник резервного копирования» на «Локальный» и сохраните после

![Восстановить вкладку](../../de/tutorial/media/restore/1575301096581-restoretab.jpg)

Если ВСЕ экземпляры должны запускаться автоматически после восстановления, необходимо активировать опцию «Запускать все адаптеры после восстановления» и впоследствии сохранять ее.
Если резервная копия восстановлена на другом хосте, эту опцию не следует использовать, поскольку перед запуском каждого экземпляра может потребоваться изменить IP-адреса.

После сохранения вы можете использовать кнопку «Получить резервные копии», чтобы получить существующие резервные копии по локальному пути.

Резервная копия, только что скопированная через FTP, должна появиться в списке под «iobroker».
Выберите это сейчас.

![Выбор резервных копий](../../de/tutorial/media/restore/1575301146928-restoreliste.jpg)

После выбора появляется сообщение о том, что iobroker остановлен для восстановления, а затем перезапущен.

![Начать восстановление](../../de/tutorial/media/restore/1575301175231-restorestart.jpg)

Здесь вы начали реальный процесс восстановления.

![Восстановление запущено](../../de/tutorial/media/restore/1575301208033-restore.jpg)

Это может занять некоторое время, в зависимости от производительности системы и размера старой установки ioBroker.
Обычно восстановление должно быть выполнено примерно через 10-15 минут и ioBroker перезапущен.

![Восстановление сделано](../../de/tutorial/media/restore/1575301228008-restorefinish.jpg)

Если реклама не меняется, время от времени обновляйте окно браузера с помощью F5.

В очень редких случаях ioBroker не запускается автоматически после восстановления.
Если это так или вы не уверены, что восстановление все еще выполняется, вы можете использовать установленный инструмент htop, чтобы увидеть, работает ли восстановление или уже завершено.
Просто введите ```htop``` в терминале. Вывод должен выглядеть примерно так.

![HTOP](../../de/tutorial/media/restore/1575363981959-htop.jpg)

В процессах, которые могут отображаться с помощью htop **ни один из** процессов, отмеченных на изображении, больше не доступен.
Если это так, остановите htop нажатием «F10» и выполните следующую команду через терминал.

```
iobroker start
```

Теперь ioBroker должен запуститься снова, и на вкладке «Журнал» вы можете видеть, что все адаптеры, которые были установлены в старой системе, переустанавливаются npm.

Здесь нужно немного терпения, и пусть просто заработает iobroker.
В случаях вы можете видеть, какие адаптеры установлены так постепенно.
Все адаптеры, которые все еще находятся в установке или в цикле ожидания, еще не имеют иконки в экземплярах.
Пожалуйста, не перезапускайте ioBroker, в большинстве случаев обновляйте представление с помощью F5, пока все экземпляры не будут иметь значок.

В зависимости от размера установки и скорости вашего компьютера и подключения к Интернету, это может легко занять 2-3 часа.

Поздравляем, теперь вновь установленная система выполнена со всеми настройками, сценариями, визуализациями и т. Д.

В Backitup все еще есть возможность восстановить дополнительные данные, если они были предварительно сохранены в старой системе.
Вы можете восстановить базу данных Redis, базу данных Zigbee, базу данных mySql и ваши данные истории, выполнив те же действия, которые описаны выше.

Список полученных резервных копий будет выглядеть следующим образом.

![полный список](../../de/tutorial/media/restore/1575362131512-fullliste.jpg)

*****************************************************************************************************************************************

#### **2. ручное восстановление с помощью команд терминала**
Прежде всего, несколько команд должны быть отправлены через Putty или что-то подобное.

Сначала необходимо создать резервную копию папки:

```
sudo mkdir /opt/iobroker/backups
```

Опять же, за этим последует программа sftp, такая как FileZilla или WinSCP - резервная копия, созданная в старой системе, и, возможно, также резервная копия Redis, резервная копия zigbee и т. Д.
хранится в папке / opt / iobroker / backups.

Если состояния и объекты были сохранены в базе данных Redis, сначала следует восстановить резервную копию базы данных Redis.
Если только штаты находились под управлением Redis, это не обязательно должно быть заранее.

Как только это будет сделано, вы остановите свой ioBroker следующим образом:

```
iobroker stop
```

После этого проверьте, остановилось ли все, с помощью следующих команд:

```
iobroker status
```

Если все проблемы исправлены и iobroker был остановлен, теперь вы можете восстановить консоль, используя следующие команды:

```
cd /opt/iobroker
iobroker restore <Dateiname eures Backups>
```

!> **Однако очень важно, чтобы с помощью этого метода можно было восстановить только резервную копию ioBroker.
Резервная копия Redis, резервная копия Zigbee, резервная копия mySql или данные истории не могут быть созданы с помощью этой команды**

Backitup требуется для этого, потому что они были созданы специально с Backitup.

Теперь это может занять несколько минут, в зависимости от системы. Прогресс отображается в терминале.
Когда восстановление будет завершено, перезапустите следующую команду ioBroker:

```
iobroker start
```

Опять же, все адаптеры будут переустанавливаться ioBroker индивидуально через npm.
Это может занять некоторое время, в зависимости от размера вашей установки, скорости интернета и производительности системы.
Текущий статус можно отслеживать на вкладке «Журнал».

Теперь все готово, система переустановлена и все настройки, скрипты, визуализации и т. Д. Восстановлены.

### Вывод:
По сути, оба варианта приводят к одному и тому же результату.
Если у вас мало опыта работы с терминальными командами и вы чувствуете себя неуверенно, то с Backitup вы в безопасности.

Однако, если вы хотите точно увидеть, что происходит в вашей системе, вам следует выбрать версию вручную через консоль. Здесь вы можете увидеть каждый процесс подробно в терминале.